name: weekly-health

on:
  schedule:
    - cron: "0 0 * * MON"  # 月曜 09:00 JST（UTC 0:00）
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  weekly:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Generate weekly report
        run: |
          python tools/devex_weekly_report.py

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "chore(report): update weekly health summary"
          title: "chore(report): weekly health summary"
          body: |
            Auto-generated weekly health summary (Run Logs 7d).
            
            This PR contains the weekly health check summary showing:
            - Total Run Log activity in the past 7 days
            - Change Class distribution (A/B/C)
            - Recent activity summary
            
            The report is automatically appended to `docs/reports/weekly.md`.
          branch: "chore/weekly-health"
          delete-branch: true